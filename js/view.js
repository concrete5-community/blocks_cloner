(()=>{"use strict";var e,n,t,r,o={417:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.hook=function(){document.addEventListener("DOMContentLoaded",(function(){var e;null===(e=window.ConcreteEvent)||void 0===e||e.subscribe("ConcreteMenuShow",(function(e,n){var t=null==n?void 0:n.menu,l=null==n?void 0:n.menuElement;t&&l&&function(e,n){var t,l=1===(null===(t=e.$element)||void 0===t?void 0:t.length)?e.$element[0]:null;if(l){var a=(0,o.parseArea)(l);if(null!==a)!function(e,n,t){if(!n.find("a[data-ccm-blocks-cloner]").length){var o=n.find("a:last");0!==o.length&&o.after($("<a data-ccm-blocks-cloner />").attr("dialog-title",((0,r.localize)("importBlockFromXmlIntoAreaName")||"Import Block from XML into %s").replace("%s",t.displayName)).attr("class","dialog-launch dropdown-item").attr("dialog-width","90%").attr("dialog-height","80%").attr("href","".concat(window.CCM_DISPATCHER_FILENAME,"/ccm/blocks_cloner/dialogs/import?cID=").concat(window.CCM_CID,"&aID=").concat(t.id,"&aHandle=").concat(encodeURIComponent(t.handle))).text((0,r.localize)("importBlockFromXml")||"Import Block from XML").dialog())}}(0,n,a);else{var i=(0,o.parseBlock)(l);null!==i&&function(e,n,t){if(!n.find("a[data-ccm-blocks-cloner]").length){var o=n.find("a:last");0!==o.length&&o.after($("<a data-ccm-blocks-cloner />").attr("dialog-title",((0,r.localize)("exportBlockTypeNameAsXml")||"Export %s block as XML").replace("%s",t.displayName)).attr("class","dialog-launch dropdown-item").attr("dialog-width","90%").attr("dialog-height","80%").attr("href","".concat(window.CCM_DISPATCHER_FILENAME,"/ccm/blocks_cloner/dialogs/export?cID=").concat(window.CCM_CID,"&bID=").concat(t.id)).text((0,r.localize)("exportAsXml")||"Export as XML").dialog())}}(0,n,i)}}}(t,l)}))}))};var r=t(438),o=t(753)},438:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.localize=function(e){var n,t=null===(n=window.ccmBlocksClonerI18N)||void 0===n?void 0:n[e];return"string"==typeof t?t:null},n.getBlockTypeName=function(e){var n;return(null===(n=window.ccmBlocksClonerI18N)||void 0===n?void 0:n._blockTypeNames[e])||null}},447:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.setElementHighlighted=function e(n,l,a){if(void 0===a&&(a=!1),l){if(t===n)return void(a&&o(t));null!==t&&e(t,!1)}l!==("1"===n.dataset.blocksClonerHighlighted)&&(l?(r.forEach((function(e,t){n.dataset["blocksClonerRestore".concat(t)]=n.style[t],n.style[t]=e})),n.dataset.blocksClonerHighlighted="1",t=n):(Array.from(r.keys()).forEach((function(e){var t=n.dataset["blocksClonerRestore".concat(e)];void 0!==t&&(delete n.dataset["blocksClonerRestore".concat(e)],n.style[e]=t)})),delete n.dataset.blocksClonerHighlighted,t=null)),t&&a&&o(t)};var t=null,r=new Map([["outline","1px solid red"],["boxShadow","0 0 3px 3px #ff0000"],["transition","box-shadow 0.5s, outline 0.5s"]]);function o(e){e.scrollIntoView&&function(e,n){new IntersectionObserver((function(e,t){n(e.some((function(e){return e.isIntersecting}))),t.disconnect()}),{root:null,rootMargin:"0px",threshold:.1}).observe(e)}(e,(function(n){if(!n)try{e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}catch(e){}}))}},753:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.parseArea=l,n.parseBlock=a,n.getPageStructure=function(e){e=Object.assign({skipAreasWithoutBlocks:!1,skipBlocksWithoutChildAreas:!1},e||{});var n={children:[]};return i(document.body,n,e),n.children.filter((function(n){return n.type===r.Area&&(!e.skipAreasWithoutBlocks||n.children.length>0)}))};var r,o=t(438);function l(e){if("DIV"!==e.tagName)return null;var n=Number(e.dataset.areaId)||0;if(n<=0)return null;var t=e.dataset.areaHandle;if(!t)return null;var o=e.dataset.areaDisplayName;return o?{type:r.Area,element:e,id:n,handle:t,displayName:o,isGlobal:e.classList.contains("ccm-global-area"),enableGridContainer:["1","true"].includes(e.dataset.areaEnableGridContainer||""),children:[]}:null}function a(e){if("DIV"!==e.tagName)return null;var n=Number(e.dataset.blockId)||0;if(n<=0)return null;var t=e.dataset.blockTypeHandle;return t?{type:r.Block,element:e,id:n,handle:t,displayName:(0,o.getBlockTypeName)(t)||t,children:[]}:null}function i(e,n,t){var o=l(e),s=o?null:a(e),d=o||s,u=n;d&&(n.children.push(d),u=d),Array.from(e.children).forEach((function(e){return i(e,u,t)})),null!==s&&t.skipBlocksWithoutChildAreas&&(c(s,r.Area)||n.children.splice(n.children.indexOf(s),1)),null!==o&&t.skipAreasWithoutBlocks&&(c(o,r.Block)||n.children.splice(n.children.indexOf(o),1))}function c(e,n){return!!e.children.some((function(e){return e.type===n}))||e.children.some((function(e){return c(e,n)}))}!function(e){e.Area="area",e.Block="block"}(r||(r={}))},953:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.getCurrentEnvironment=r,n.extractEnvironment=o,n.addCurrentEnvironmentComment=function(e){return"string"==typeof e?function(e){if(null!==o(e))throw new Error("Environment comment already exists");var n=a();if(n.length>0){var t=(new DOMParser).parseFromString("<root />","application/xml").createComment(n);e=e.trimEnd()+"\n"+(new XMLSerializer).serializeToString(t)}return e}(e):function(e){if(null!==o(e))throw new Error("Environment comment already exists");var n=a();if(0===n.length)return!1;var t=e.createComment(n);return document.documentElement.appendChild(t),!0}(e)};var t="Environment:";function r(){var e;return(null===(e=window.ccmBlocksClonerI18N)||void 0===e?void 0:e._environment)||null}function o(e){if("string"==typeof e)return o((new DOMParser).parseFromString("<root>".concat(e.replace(/^<\?xml[^>]*>\s*/i,""),"</root>"),"application/xml"));for(var n=null,t=e.createTreeWalker(e.documentElement,NodeFilter.SHOW_COMMENT);null!==t.nextNode();){var r=l(t.currentNode);if(null!==r){if(null!==n)throw new Error("Multiple environment comments found");n=r}}return n}function l(e){if(e.nodeType!==Node.COMMENT_NODE)return null;var n=(e.textContent||"").trim();if(!n.startsWith(t))return null;try{var r=JSON.parse(n.substring(t.length).trim());if("object"!=typeof r||null===r)throw new Error("Invalid environment comment");var o="string"==typeof r.core?r.core.trim():"";if(0===o.length)throw new Error("Missing core");var l={};if(!(r.packages instanceof Array)||0!==r.packages.length){if("object"!=typeof r.packages||null===r.packages)throw new Error("Missing packages");for(var a in r.packages){if(0===a.length||"string"!=typeof r.packages[a])throw new Error("Invalid package");if(l[a]=r.packages[a].trim(),0===l[a].length)throw new Error("Invalid package")}}return{core:o,packages:l}}catch(e){return console.error("Failed to parse environment comment",e),null}}function a(){var e=r();return null===e?"":" ".concat(t," ").concat(JSON.stringify(e)," ")}}},l={};function a(e){var n=l[e];if(void 0!==n)return n.exports;var t=l[e]={exports:{}};return o[e](t,t.exports,a),t.exports}e=a(953),n=a(447),t=a(417),r=a(753),void 0===window.ccmBlocksCloner&&(window.ccmBlocksCloner={getPageStructure:r.getPageStructure,setElementHighlighted:n.setElementHighlighted,envirorment:{getCurrent:e.getCurrentEnvironment,addCurrentToXml:e.addCurrentEnvironmentComment,extractFromXml:e.extractEnvironment}},(0,t.hook)())})();